[tox]
envlist = py39,py310,py311,py312,py313,lint,package,package-matplotlib
isolated_build = true
skip_missing_interpreters = true

[testenv]
description = Run tests with pytest (with matplotlib)
# Use only binary wheels to avoid slow compilation
install_command = python -I -m pip install --only-binary :all: {opts} {packages}
deps =
    pytest>=7.0
    pytest-cov>=4.0
    matplotlib>=3.5
    networkx>=2.8
    click>=8.0
commands =
    pytest tests/ -v --cov=codegraph --cov-report=term-missing {posargs}

[testenv:lint]
description = Run linting with flake8
deps =
    flake8>=5.0
commands =
    flake8 codegraph/ tests/

[testenv:package]
description = Test package installation and usage without matplotlib
skip_install = true
allowlist_externals = bash
deps =
    build
    pytest>=7.0
commands =
    python -m build --wheel --outdir {envtmpdir}/dist
    bash -c 'pip install {envtmpdir}/dist/codegraph-*.whl'
    pytest tests/test_package_install.py -v {posargs}

[testenv:package-matplotlib]
description = Test package installation with matplotlib extra
skip_install = true
allowlist_externals = bash
deps =
    build
    pytest>=7.0
commands =
    python -m build --wheel --outdir {envtmpdir}/dist
    bash -c 'pip install --force-reinstall {envtmpdir}/dist/codegraph-*.whl'
    pip install matplotlib networkx
    pytest tests/ -v {posargs}

[testenv:py39]
basepython = python3.9

[testenv:py310]
basepython = python3.10

[testenv:py311]
basepython = python3.11

[testenv:py312]
basepython = python3.12

[testenv:py313]
basepython = python3.13

[flake8]
max-line-length = 120
exclude = .tox,dist,build,*.egg-info
per-file-ignores =
    __init__.py:F401
    vizualyzer.py:E501
